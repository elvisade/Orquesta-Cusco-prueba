<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Asistencia Orquestando</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: url("fondo.jpg") no-repeat center center fixed;
  background-size: cover;
}

header {
  text-align: center;
  background: rgba(0,0,0,0.7);
  padding: 20px;
  color: white;
}

header img {
  max-width: 300px;
}

.container {
  width: 90%;
  margin: auto;
  margin-top: 20px;
  background: rgba(255,255,255,0.95);
  padding: 20px;
  border-radius: 10px;
}

.botones {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

button {
  padding: 10px 15px;
  font-size: 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

button i {
  margin-right: 5px;
}

.entrada { background: #4CAF50; color: white; }
.salida { background: #f44336; color: white; }
.ver { background: #2196F3; color: white; }
.excel { background: #2e7d32; color: white; }
.admin { background: #ff9800; color: black; }

#calendario {
  transform: scale(0.67);
  transform-origin: top center;
  margin-top: -120px;
}

.semana {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
}

.dia {
  border: 1px solid #ccc;
  padding: 8px;
  min-height: 80px;
  font-size: 12px;
}

.sabado { background: #ffe0e0; }
.domingo { background: #ffd6d6; }

.encabezado {
  font-weight: bold;
  text-align: center;
  background: #ddd;
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Orquestando">
  <h1>CICLO VACACIONAL ORQUESTANDO 2026</h1>
</header>

<div class="container">

<select id="educador">
  <option value="">Seleccionar educador</option>
  <option value="Elvis Ylla Uscamayta">Elvis Ylla Uscamayta</option>
  <option value="Nilton Ibarra Vilchez">Nilton Ibarra Vilchez</option>
  <option value="Hector Roberto Galvez Zuñiga">Hector Roberto Galvez Zuñiga</option>
</select>

<input type="password" id="pin" placeholder="PIN de seguridad">

<div class="botones">
  <button class="entrada" onclick="marcar('entrada')">
    <i class="fa-solid fa-right-to-bracket"></i> Entrada
  </button>

  <button class="salida" onclick="marcar('salida')">
    <i class="fa-solid fa-right-from-bracket"></i> Salida
  </button>

  <button class="ver" onclick="verAsistencias()">
    <i class="fa-solid fa-calendar-days"></i> Ver asistencias
  </button>

  <button class="excel" onclick="descargarExcel()">
    <i class="fa-solid fa-file-excel"></i> Descargar Excel
  </button>

  <button class="admin" onclick="modoAdmin()">
    <i class="fa-solid fa-gear"></i> Administrador
  </button>
</div>

<div id="calendario"></div>

</div>

<script>
const pines = {
  "Elvis Ylla Uscamayta": "20261",
  "Nilton Ibarra Vilchez": "20262",
  "Hector Roberto Galvez Zuñiga": "20263"
};

let asistencias = JSON.parse(localStorage.getItem("asistencias")) || {};
let admin = false;

function marcar(tipo) {
  const e = educador.value;
  const p = pin.value;
  if (!e || pines[e] !== p) {
    alert("PIN incorrecto");
    return;
  }
  const fecha = new Date().toISOString().slice(0,10);
  if (!asistencias[e]) asistencias[e] = {};
  if (!asistencias[e][fecha]) asistencias[e][fecha] = {};
  asistencias[e][fecha][tipo] = new Date().toLocaleTimeString();
  localStorage.setItem("asistencias", JSON.stringify(asistencias));
  alert(tipo.toUpperCase() + " registrada");
}

function verAsistencias() {
  const cal = document.getElementById("calendario");
  cal.innerHTML = "";

  const dias = ["Sábado","Domingo","Lunes","Martes","Miércoles","Jueves","Viernes"];
  let fila = document.createElement("div");
  fila.className = "semana";

  dias.forEach(d => {
    let div = document.createElement("div");
    div.className = "dia encabezado";
    div.innerText = d;
    fila.appendChild(div);
  });

  cal.appendChild(fila);

  for (let i=1;i<=31;i++) {
    let div = document.createElement("div");
    div.className = "dia";
    div.innerText = i;
    cal.appendChild(div);
  }
}

function modoAdmin() {
  admin = !admin;
  alert(admin ? "Modo administrador activado" : "Modo administrador desactivado");
}

function descargarExcel() {
  let csv = "Educador,Fecha,Entrada,Salida\n";
  for (let e in asistencias) {
    for (let f in asistencias[e]) {
      csv += `${e},${f},${asistencias[e][f].entrada||""},${asistencias[e][f].salida||""}\n`;
    }
  }
  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "asistencias.csv";
  a.click();
}
</script>

</body>
</html>
